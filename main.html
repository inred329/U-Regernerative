<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scrollytelling Character Movement</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      overflow: hidden;
      font-family: Arial, Helvetica, sans-serif;
    }

    #game-stage {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    #background {
      position: fixed;
      inset: 0;
      background-image: url('images/green1.png');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      z-index: 1;
      transform: translateX(0px);
    }

    #character {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 109.6px;
      height: 180px;
      z-index: 3;
      background-repeat: no-repeat;
      background-position: center bottom;
      background-size: contain;
      will-change: transform, width, height;
    }

    #transition-wave {
      position: absolute;
      left: 0;
      top: 100%;
      width: 100%;
      height: 400%;
      background-image: url('images/wave.png');
      background-size: cover;
      background-repeat: no-repeat;
      z-index: 4;
      transition: top 1s ease-in-out;
      pointer-events: none;
    }

    #transition-wave.active {
      top: -300%;
    }
  </style>
</head>
<body>
  <div id="game-stage">
    <div id="background"></div>
    <div id="character" aria-label="Character"></div>
    <div id="transition-wave"></div>
  </div>

  <script>
    // CONFIG
    const CONFIG = {
      land: {
        bg: 'images/green1.png',
        dims: { w: '109.6px', h: '180px' },
        frames: 6,
        prefix: 'svgs/Walk_man_'
      },
      water: {
        bg: 'images/blue1.png',
        dims: { w: '225.2px', h: '181.3px' },
        frames: 7,
        prefix: 'svgs/Swim_man_'
      }
    };

    // STATE
    let state = {
      isWater: false,
      isLocked: false,
      charX: 0,
      bgX: 0,
      frameIndex: 1
    };

    // ELEMENTS
    const els = {
      char: document.getElementById('character'),
      bg: document.getElementById('background'),
      wave: document.getElementById('transition-wave')
    };

    // INIT
    function init() {
      Object.assign(els.char.style, {
        width: CONFIG.land.dims.w,
        height: CONFIG.land.dims.h,
        backgroundImage: `url('${CONFIG.land.prefix}1.svg')`
      });
    }

    // RENDER
    function render() {
      els.char.style.transform = `translateX(${state.charX}px)`;
      els.bg.style.transform = `translateX(${state.bgX}px)`;
    }

    // SCROLL HANDLER
    window.addEventListener('wheel', (e) => {
      if (state.isLocked) return;

      const speed = 5;
      const direction = e.deltaY > 0 ? 1 : -1;

      state.frameIndex += 0.2;

      if (direction > 0) {
        state.charX += speed;
        state.bgX -= speed * 0.5;
        els.char.style.transform = `scaleX(1) translateX(${state.charX}px)`;

        if (!state.isWater && state.charX > window.innerWidth) {
          triggerTransition('toWater');
        }
      } else {
        state.charX -= speed;
        state.bgX += speed * 0.5;
        els.char.style.transform = `scaleX(-1) translateX(${Math.abs(state.charX)}px)`;

        if (state.isWater && state.charX < -50) {
          triggerTransition('toLand');
        }
      }

      const currentConfig = state.isWater ? CONFIG.water : CONFIG.land;
      const frame = Math.floor(state.frameIndex) % currentConfig.frames + 1;
      const extension = state.isWater ? 'png' : 'svg';
      els.char.style.backgroundImage = `url('${currentConfig.prefix}${frame}.${extension}')`;

      render();
    }, { passive: true });

    // TRANSITION HANDLER
    function triggerTransition(type) {
      if (state.isLocked) return;
      state.isLocked = true;

      els.wave.classList.add('active');

      setTimeout(() => {
        if (type === 'toWater') {
          state.isWater = true;
          state.charX = 0;
          state.bgX = 0;
          els.char.style.width = CONFIG.water.dims.w;
          els.char.style.height = CONFIG.water.dims.h;
          els.bg.style.backgroundImage = `url('${CONFIG.water.bg}')`;
        } else {
          state.isWater = false;
          state.charX = window.innerWidth - 150;
          els.char.style.width = CONFIG.land.dims.w;
          els.char.style.height = CONFIG.land.dims.h;
          els.bg.style.backgroundImage = `url('${CONFIG.land.bg}')`;
        }

        state.frameIndex = 1;
        render();
      }, 1000);

      setTimeout(() => {
        els.wave.classList.remove('active');
        state.isLocked = false;
      }, 2000);
    }

    init();
  </script>
</body>
</html>
