<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journey Transition</title>
    <style>
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden;
            background-color: #000; font-family: sans-serif;
            overscroll-behavior: none; touch-action: none;
        }

        /* UI: Loading */
        #loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #1a1a1a; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; transition: opacity 0.5s ease; }
        #loading-screen.fade-out { opacity: 0; pointer-events: none; }
        .loading-bar-container { width: 300px; height: 10px; background-color: #333; border-radius: 5px; overflow: hidden; margin-top: 20px; }
        .loading-bar { width: 0%; height: 100%; background-color: #4CAF50; transition: width 0.1s linear; }
        .loading-text { font-size: 18px; letter-spacing: 2px; }

        /* Stage */
        #game-stage { position: relative; width: 100vw; height: 100vh; overflow: hidden; opacity: 0; transition: opacity 0.5s ease; }
        #game-stage.ready { opacity: 1; }
        #scrolling-layer { position: absolute; top: 0; left: 0; height: 100%; will-change: transform; z-index: 1; }
        #bg-img { display: block; height: 100%; width: auto; max-width: none; }
        
        @keyframes floating { 0% { transform: translateY(0px) rotate(0deg); } 50% { transform: translateY(-10px) rotate(2deg); } 100% { transform: translateY(0px) rotate(0deg); } }
        .scene-obj { position: absolute; background-repeat: no-repeat; background-size: contain; background-position: center; z-index: 2; transition: opacity 0.3s; animation: floating 4s ease-in-out infinite; cursor: pointer; }
        .scene-obj:hover { animation-play-state: paused; filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.8)); }
        #obj1 { animation-duration: 3.5s; animation-delay: 0s; }
        #obj2 { animation-duration: 5s; animation-delay: 1.5s; }
        #character { position: absolute; bottom: 10%; left: 0; z-index: 10; background-repeat: no-repeat; background-size: contain; background-position: center bottom; transition: width 0.1s, height 0.1s; }
        #transition-wave { position: fixed; left: 0; width: 100%; z-index: 999; pointer-events: none; height: 400%; top: 100%; background-image: url('images/wave.png'); background-size: cover; background-position: top center; transition: top 1.5s ease-in-out; }
        #transition-wave.active { top: -300%; }

        /* Card System */
        #card-system {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 2000;
            background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.4s ease;
        }
        #card-system.show { opacity: 1; pointer-events: auto; }

        .card-content-wrapper { display: flex; gap: 20px; align-items: center; transform: scale(0.9); opacity: 0; transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.4s ease; }
        #card-system.show .card-content-wrapper { transform: scale(1.3); opacity: 1; }

        .card-left-section, .card-right-section { width: 350px; height: 525px; position: relative; display: flex; justify-content: center; }
        .card-left-img { width: 100%; height: 525px; object-fit: fill; background-color: transparent; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.5)); cursor: default; }

        .card-stack-wrapper {
            position: absolute; top: 0; left: 0; width: 100%; height: 525px; 
            display: flex; flex-direction: column; align-items: center; cursor: pointer;
            transition: transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1), z-index 0s;
        }
        .card-stack-img { width: 100%; height: 100%; object-fit: fill; background-color: transparent; filter: drop-shadow(0 15px 25px rgba(0,0,0,0.5)); transition: filter 0.5s; }

        /* Card Read More Button */
        .read-more-btn {
            position: absolute; bottom: 40px; left: 50px; width: 150px; height: auto; cursor: pointer; z-index: 10; 
            transition: transform 0.2s ease, opacity 0.3s ease; opacity: 0; pointer-events: none; 
        }
        .read-more-btn:hover { transform: scale(1.1); }
        .card-stack-wrapper[data-layer="1"] .read-more-btn { opacity: 1; pointer-events: auto; }

        /* üî¥ Card Close Button (New Style) */
        .card-close-btn {
            position: absolute; top: 30px; right: 30px; width: 25px; height: auto;
            cursor: pointer; z-index: 20; transition: transform 0.2s ease;
            opacity: 0; pointer-events: none; /* È†êË®≠Èö±ËóèÔºåÂè™ÊúâÂú®Á¨¨‰∏ÄÂ±§È°ØÁ§∫ */
        }
        .card-close-btn:hover { transform: scale(1.1); }
        /* Âè™ÊúâÁï∂Âç°ÁâáÂú® Layer 1 (ÊúÄ‰∏äÂ±§) ÊôÇÔºåÊâçÈ°ØÁ§∫ÈóúÈñâÊåâÈàïÔºåÈÅøÂÖçË™§Ëß∏ÂæåÈù¢ÁöÑÂç°Áâá */
        .card-stack-wrapper[data-layer="1"] .card-close-btn { opacity: 1; pointer-events: auto; }

        .card-stack-wrapper[data-layer="1"] { z-index: 3; transform: translateX(0px) scale(1); }
        .card-stack-wrapper[data-layer="1"] .card-stack-img { filter: brightness(1) drop-shadow(0 15px 25px rgba(0,0,0,0.5)); }
        .card-stack-wrapper[data-layer="2"] { z-index: 2; transform: translateX(100px) scale(0.95); }
        .card-stack-wrapper[data-layer="2"] .card-stack-img { filter: brightness(0.6) drop-shadow(0 15px 25px rgba(0,0,0,0.5)); }
        .card-stack-wrapper[data-layer="3"] { z-index: 1; transform: translateX(200px) scale(0.9); }
        .card-stack-wrapper[data-layer="3"] .card-stack-img { filter: brightness(0.4) drop-shadow(0 15px 25px rgba(0,0,0,0.5)); }

        @media (max-width: 900px) {
            .card-content-wrapper { flex-direction: column; align-items: center; gap: 40px; transform: scale(0.65) !important; }
            #card-system.show .card-content-wrapper { transform: scale(0.85) !important; }
        }

        /* =========================================
           Universal Modal
           ========================================= */
        .fullscreen-modal {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 3000;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .fullscreen-modal.show { opacity: 1; pointer-events: auto; }

        .modal-inner-wrapper { position: relative; display: inline-block; max-width: 100vw; max-height: 100vh; transition: width 0.3s ease; }
        .modal-bg-img { display: block; height: 95vh; width: auto; object-fit: contain; cursor: zoom-in; box-shadow: 0 0 30px rgba(0,0,0,0.5); }

        /* Dynamic Content */
        .dynamic-content-area {
            position: absolute; top: 15%; left: 10%; width: 80%; height: 60%; 
            overflow-y: auto; color: #333; font-size: 1rem; line-height: 1.6; text-align: left; z-index: 15;
            scrollbar-width: none; -ms-overflow-style: none;
        }
        .dynamic-content-area::-webkit-scrollbar { display: none; }
        .dynamic-content-area h2 { margin-top: 0; color: #1a5f1a; font-size: 1.8rem; border-bottom: 2px solid #ccc; padding-bottom: 10px;}
        .dynamic-content-area h3 { margin-top: 20px; color: #1a5f1a; font-size: 1.2rem; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .dynamic-content-area p { margin-bottom: 15px; }
        .dynamic-content-area img.content-pic { width: 100%; border-radius: 8px; margin: 10px 0; }
        .dynamic-content-area ul { padding-left: 20px; margin-bottom: 15px; }

        .fullscreen-modal.zoomed { display: block; overflow-y: auto; text-align: center; }
        .fullscreen-modal.zoomed .modal-inner-wrapper { display: inline-block; width: 100vw; max-width: none; max-height: none; }
        .fullscreen-modal.zoomed .modal-bg-img { width: 100vw; height: auto; cursor: zoom-out; }
        
        .modal-interactive-btn { 
            position: absolute; z-index: 20; cursor: pointer; transition: transform 0.2s; width: 20%; 
        }
        .modal-interactive-btn:hover { transform: scale(1.05); }
        .modal-interactive-btn.playing { filter: drop-shadow(0 0 10px #00ff00); }
        
        .bottom-left { bottom: 6%; left: 8%; }
        .bottom-right { bottom: 6%; right: 8%; }

        .modal-close-btn {
            position: absolute; top: 20px; right: 20px; width: 25px; height: auto;
            cursor: pointer; z-index: 30; transition: transform 0.2s ease;
        }
        .modal-close-btn:hover { transform: scale(1.1); }

        .hidden { display: none !important; }

    </style>
</head>
<body>

<div id="loading-screen">
    <div class="loading-text">LOADING... 0%</div>
    <div class="loading-bar-container"><div class="loading-bar"></div></div>
</div>

<div id="game-stage">
    <div id="scrolling-layer">
        <img id="bg-img" src="" alt="Background">
        <div class="scene-obj" id="obj1"></div>
        <div class="scene-obj" id="obj2"></div>
    </div>
    <div id="character"></div>
    <div id="transition-wave"></div>

    <div id="card-system">
        <div class="card-content-wrapper">
            <div class="card-left-section">
                <img id="card-left-display" class="card-left-img" src="" alt="Intro Card">
            </div>
            <div class="card-right-section">
                <div class="card-stack-wrapper" data-layer="1">
                    <img class="card-stack-img" id="stack-img-1" src="" alt="Card 1">
                    <img class="card-close-btn" src="images/cross.png" alt="Close Cards">
                    <img class="read-more-btn" data-card-index="0" src="images/READ_MORE.png" alt="Read More">
                </div>
                <div class="card-stack-wrapper" data-layer="2">
                    <img class="card-stack-img" id="stack-img-2" src="" alt="Card 2">
                    <img class="card-close-btn" src="images/cross.png" alt="Close Cards">
                    <img class="read-more-btn" data-card-index="1" src="images/READ_MORE.png" alt="Read More">
                </div>
                <div class="card-stack-wrapper" data-layer="3">
                    <img class="card-stack-img" id="stack-img-3" src="" alt="Card 3">
                    <img class="card-close-btn" src="images/cross.png" alt="Close Cards">
                    <img class="read-more-btn" data-card-index="2" src="images/READ_MORE.png" alt="Read More">
                </div>
            </div>
        </div>
    </div>

    <div id="universal-modal" class="fullscreen-modal">
        <div class="modal-inner-wrapper">
            <img id="modal-bg-img" class="modal-bg-img" src="" alt="Container">
            <div id="modal-content-area" class="dynamic-content-area"></div>
            
            <img id="modal-btn-close" class="modal-close-btn" src="images/cross.png" alt="Close">
            <img id="modal-btn-music" class="modal-interactive-btn bottom-left hidden" src="images/PLAY_MUSIC.png" alt="Play Music">
            <img id="modal-btn-next-layer" class="modal-interactive-btn bottom-right hidden" src="images/READ_MORE.png" alt="Read More">
            <img id="modal-btn-gain-points" class="modal-interactive-btn bottom-right hidden" src="images/GAIN_POINTS.png" alt="Gain Points">
        </div>
    </div>
</div>

<script>
    const CONFIG = {
        land: {
            bg: 'images/green1.png',
            dims: { w: '109.6px', h: '180px' },
            frames: 6, pathPrefix: 'svgs/Walk_man_', ext: '.svg',
            objects: [
                { 
                    id: 'fern', src: 'images/fern.png', w: '150px', h: '150px', left: '10%', bottom: '40%',
                    content: [
                        { shortHtml: `<div style="margin-bottom: 20px;"><p style="font-size: 0.9rem; border-left: 4px solid #000; padding-left: 10px; line-height: 1.4;"><span style="font-weight: 900; text-transform: uppercase;">Fun Fact: Did you know?</span><br>Cloud Forest acts like a giant water tower of our planet?!</p><h2 style="font-weight: 900; text-transform: uppercase; font-size: 2rem; line-height: 1.1; margin-top: 15px; border-bottom: none;">THE MAGICAL COMB ‚Äì<br>CLOUD FORESTS</h2></div><img class="content-pic" src="images/fern_content_1.jpg" alt="Cloud Forest" style="margin-bottom: 5px;"><p>Cloud forests play a unique ecological role by capturing moisture not only through rainfall but also through humidity, mist and fog. These <b>horizontal water inputs</b> reduce solar radiation and temperature, shaping local conditions and limiting evapotranspiration. Despite being among the most biodiverse ecosystems on Earth, cloud forests occupy <b>less than 1%</b> of the planet and depend on precise combinations of altitude, temperature and high humidity.</p><p>Today, they are rapidly disappearing due to monocultural agriculture, chemical practices and climate change. <b>Rising temperatures</b> are pushing cloud ceilings <b>higher</b>, leaving original vegetation exposed to <b>drier</b> conditions. Beyond their ecological value, cloud forests hold deep cultural significance, especially in Asia, where seas of clouds have long symbolised transcendence, beauty and the connection between earthly and celestial realms.</p><p style="font-weight: bold; margin-top: 30px; margin-bottom: 60px;">Want to explore deeper into the clouds?</p>`, longHtml: `<div style="margin-bottom: 20px;"><p style="font-size: 0.9rem; border-left: 4px solid #000; padding-left: 10px; line-height: 1.4;"><span style="font-weight: 900; text-transform: uppercase;">Fun Fact: Did you know?</span><br>Cloud Forests inspired so many poets across millennia?!</p><h2 style="font-weight: 900; text-transform: uppercase; font-size: 2rem; line-height: 1.1; margin-top: 15px; border-bottom: none;">THE MAGICAL COMB ‚Äì<br>CLOUD FORESTS</h2></div><img class="content-pic" src="images/fern_content_2.jpg" alt="Mythical Woods" style="margin-bottom: 5px;"><p>The significance of precipitation to the recipient ecosystems is well-known but it‚Äôs limited to its <b>ferocity</b> (rain gauge in one time and depending on various types of soil, which signifies different capacity of absorption), categorised as <b>vertical</b> water effect. However, the <b>horizontal</b> layer matters too - the humidity in the air. Cloud Forests serve in this particular role. Clouds, mists and fogs can dramatically affect local environmental conditions including reductions of <b>solar radiation</b>, <b>temperature</b> and thereby <b>evapotranspiration</b>.</p><p>While being the most biodiverse places on Earth, Cloud forests are becoming increasingly difficult to find due to environmental changes and human pressure. Accounting for <b>less than 1%</b> on Earth, they require a precise combination of factors : specific <b>temperature ranges</b>, high <b>humidity</b> and <b>drastic</b> change in <b>altitude</b>, which explains why it happens easily in tropical montane systems (in narrow definition) but on coastlines as well. In other words, the air masses are highly humid and the <b>adiabatic lapse rate</b> could guarantee the condensation point to be reached (the reason why clouds exist). As a result, they are dominated by <b>broad-leaved evergreen trees</b>, <b>epiphytes</b> and <b>epiphylls</b>.</p><p>Due to excessive mono-cultural practises (e.g. EU recently reaccepted using Glyphosate for weed control - resulting in bracken dominated troubles years after) such as planting <b>tea plant</b> (Camellia sinensis) and <b>coffee</b> (Coffea), the most valuable agricultural commodities worldwide, this particular type of ecosystems is receding drastically in the last 2 decades. In addition, with Global Warming, the cloud ceiling is moving higher as a manifestation of a critical interaction between temperature and moisture supply. Some research in the Appalachians indicate the ceilings are deserting the original cloud forest vegetation which will be exposed in <b>drier</b> conditions thus disappearing indefinitely.</p><p>Interestingly, the <b>ecotones</b> (adjacent systems on the border of 2 different ones) of Cloud Forests are <b>beautifully</b> unique, supporting rare assemblages of species, often fostering evolution & diversity in the long run and facilitating species <b>transition</b>, such as predator movement across different environments.</p><p>From another perspective, this magical comb holds a grand significance in Asian cultures across millennia, representing aesthetic, spiritual and symbolic value. It‚Äôs the bridge between the earthly and celestial realms to many folktales and the inspirations to numerous great poets.</p><p>These unique phenomena (Yunhai = Sea of Clouds) have been regarded as otherworldly scenes evoking feelings of peace and transcendence, a <b>cultural heritage</b> in human history.</p><p style="font-weight: bold; margin-top: 30px; margin-bottom: 60px;">Want to know what actions you can take to make a difference?</p>` },
                        { shortHtml: `<h2 style="font-weight: 900; text-transform: uppercase; font-size: 1.8rem; line-height: 1.2; margin-bottom: 20px; color: #1a5f1a;">Cloud Forest Poetry ‚Äì<br>Among the White Clouds</h2><p>In Chinese poetry, cloud forests inspired numerous Tang Dynasty poets, including Du Mu, Wang Wei, Li Bai, and Han Shan. They are frequently depicted within <b>shanshui</b> (mountain and stream) poetry, emphasizing reclusion, the harmony between man and nature, and Taoist or Buddhist themes of emptiness and transcendence.</p><img class="content-pic" src="images/fern_card2_content.jpg" alt="Shanshui Painting" style="margin: 20px 0;"><p>Cloud forests often appear in imagery such as "spitting mist" and "moss is slippery", reflecting the abundance of epiphytes found in these ecosystems. As written in <i>The Cold Mountain Poems</i>:</p><div style="background-color: rgba(255,255,255,0.7); padding: 15px; border-left: 4px solid #555; margin: 20px 0; font-style: italic;"><p style="margin: 0; font-family: serif;">"The long gorge choked with scree and boulders,<br>The wide creek, the mist blurred grass.<br><b>The moss is slippery, though there's been no rain,</b><br>The pine sings, but there's no wind.<br>Who can leap the world's ties<br>And sit with me among the white clouds?"</p><p style="margin-top: 10px; font-size: 0.9rem; color: #666; text-align: right;">‚Äî Han Shan (Cold Mountain)</p></div><p><b>Shanshui</b> paintings echo these same cloud forests, where mist erases boundaries between mountains, trees, and the human spirit. In both art and poetry, cloud forests are not just landscapes‚Äîthey are places to disappear into.</p>`, longHtml: `` },
                        { shortHtml: `<h2 style="font-weight: 900; text-transform: uppercase; font-size: 1.8rem; line-height: 1.2; margin-bottom: 10px; color: #1a5f1a;">CLOUD FOREST ‚Äì<br>WHAT YOU CAN DO</h2><div style="margin-bottom: 20px;"><p style="margin-bottom: 15px;"><b>1. Support regenerative agriculture products:</b><br>Purchase sustainably produced products from syntropic farms (e.g., regions like Kenya). <b>Agroforestry</b> and <b>Syntropic farming</b> integrate shade-tolerant crops‚Äîsuch as coffee and cacao‚Äîwith native tree species. This helps protect biodiversity, improve soil health, and enhance environmental resilience.</p><p style="margin-bottom: 15px;"><b>2. Choose "ugly" fruits and vegetables:</b><br>Stop pursuing standardized, perfect appearances. Prioritise imperfect produce and accept seasonal yield variations. This is the most genuine way to protect regenerating land.</p><p style="margin-bottom: 10px;"><b>3. Choose products with sustainability certifications:</b><br>Look for these logos to support forest conservation, fair labor, and organic practices:</p><img class="content-pic" src="images/fern_card3_certs.jpg" alt="Sustainability Certifications" style="margin: 5px 0 15px 0; background: white; padding: 10px; border-radius: 8px;"><ul style="padding-left: 20px; margin-bottom: 15px; font-size: 0.9rem; color: #444;"><li><b>Rainforest Alliance:</b> Focuses on environmental protection and sustainable production.</li><li><b>Smithsonian Bird Friendly¬Æ:</b> Gold-standard for protecting bird habitats and shade cover.</li><li><b>Fair Trade:</b> Focuses on fair pricing and labor rights.</li><li><b>USDA Organic:</b> Grown without synthetic pesticides or GMOs.</li></ul><p style="margin-bottom: 15px;"><b>4. Support regulatory measures:</b><br>Support policies like the <b>EU Deforestation Regulation (EUDR)</b>, which requires companies to prove their products are not sourced from recently deforested land.</p><p><b>5. Promote whole-plant utilization:</b><br>Choose products that use agricultural by-products‚Äîsuch as <b>cascara</b> (coffee cherry tea), reused coffee grounds, or cacao husks. This increases farm income and reduces the pressure to clear new land.</p></div>`, longHtml: `` }
                    ]
                },
                { 
                    id: 'flower', src: 'images/flower.png', w: '150px', h: '150px', left: '40%', bottom: '10%',
                    content: [
                        { shortHtml: `<div style="margin-bottom: 20px;"><p style="font-size: 0.9rem; border-left: 4px solid #000; padding-left: 10px; line-height: 1.4;"><span style="font-weight: 900; text-transform: uppercase;">Fun Fact: Did you know?</span><br>While you were looking at your phone, you might have just missed something super cool?!</p><h2 style="font-weight: 900; text-transform: uppercase; font-size: 2rem; line-height: 1.1; margin-top: 15px; border-bottom: none;">PHANTOM IMAGE ‚Äì<br>FATA MORGANA</h2></div><img class="content-pic" src="images/flower_content_1.jpg" alt="Fata Morgana" style="margin-bottom: 5px;"><p>Mirages appear when <b>light bends</b> as it moves through layers of air with different temperature and moisture levels. Under the right conditions, distant landscapes seem to resize, stretch or float, resulting in mountains overlapping with themselves, coastlines rising from the horizon, and illusions in the deserts.</p><p>What we see is real light, but repositioned by the atmosphere. These effects occur when air layers of different densities curve light along unexpected paths. The landscape seems to hover between stability and distortion, blurring the line between what is physically present and what only appears to be. Depth becomes difficult to judge and solid objects appear suspended or mysteriously displaced.</p><p>Across cultures, these atmospheric illusions have inspired names, myths, and stories. In Icelandic and Old Norse traditions, such visions were called <b>Hillingar</b>, meaning ‚Äúupheaving‚Äù, while in southern Europe they became known as <b>Fata Morgana</b>, named after a sorceress from Arthurian legend. Though science now explains them as light bending through air, their beauty still resists simple explanation.</p>`, longHtml: `<div style="margin-bottom: 20px;"><p style="font-size: 0.9rem; border-left: 4px solid #000; padding-left: 10px; line-height: 1.4;"><span style="font-weight: 900; text-transform: uppercase;">Fun Fact: Did you know?</span><br>Dawn or dusk is the best time for spotting miracles?!</p><h2 style="font-weight: 900; text-transform: uppercase; font-size: 2rem; line-height: 1.1; margin-top: 15px; border-bottom: none;">NATURE‚ÄôS TRICK OF THE EYES ‚Äì<br>MIRAGES</h2></div><img class="content-pic" src="images/flower_content_2.jpg" alt="Mirages" style="margin-bottom: 5px;"><p>Lights can be bent when travelling through layers of air with different temperatures and moisture levels. Because air density changes with temperature, light does not always move in straight lines. Instead, it curves, causing light rays to reach the observer along unexpected paths and at slightly different times. The result is not an illusion in the sense of something imaginary, but a real image that has been displaced, stretched, inverted, or multiplied by the atmosphere itself.</p><p>The most familiar type is the <b>desert mirage</b>. Here, extremely hot ground heats the air just above the surface, creating a layer of low-density air beneath cooler, denser air. Light bends upward through this stratification, producing unstable, inverted images that often resemble pools of water or floating reflections. Objects may appear distorted or flipped, shimmering and difficult to fix in place.</p><p>In contrast, <b>arctic mirages</b>‚Äîalso known as <b>hillingar</b>‚Äîoccur under nearly opposite conditions. When the ground is much colder than the air above it, dense air forms at the surface, bending light downward. This causes distant objects to appear lifted above the horizon while remaining upright. Such mirages can make coastlines, mountains, or ships seem closer, taller, or suspended in midair. It is believed that hillingar may have played a role in helping Norse explorers discover Iceland and Greenland by revealing land otherwise hidden beyond the Earth‚Äôs curvature.</p><p>Between these two extremes lies one of the most complex and striking forms: the <b>Fata Morgana</b>. This type of mirage forms under transitional conditions, when temperature inversion layers stack <b>unevenly</b> in the atmosphere. Light may be bent both upward and downward, producing multiple images of the same object‚Äîsome upright, some inverted‚Äîoften compressed or elongated into <b>fantastical shapes</b>. These mirages can change rapidly, making them especially difficult to interpret.</p><p>Because mirages rely on precise atmospheric conditions, they are fleeting and unstable. Their shifting nature has long misled observers, sometimes with serious consequences. Ships have appeared to hover above the sea, vanish entirely, or reappear in impossible positions. Legends such as the <b>Flying Dutchman</b> may have been influenced by these atmospheric effects, where real objects seemed to defy physical laws and take on a supernatural character.</p><p>Across cultures, mirages have inspired names, myths, and stories that reflect both awe and uncertainty. Though science now explains them as light bending through stratified air, their visual impact still resists easy categorisation. Mirages remind us that <b>perception is shaped</b> not only by what exists, but by the invisible structure of the atmosphere itself‚Äîan ever-changing lens that can momentarily rearrange reality before returning it to place.</p><p style="font-weight: bold; margin-top: 30px; margin-bottom: 60px;">Want to know when/where would be the best to spot it?</p>` },
                        { shortHtml: `<h2 style="font-weight: 900; text-transform: uppercase; font-size: 1.8rem; line-height: 1.2; margin-bottom: 20px; color: #1a5f1a;">Mirages ‚Äì<br>Idioms Behind Nature‚Äôs Illusion</h2><p>Mirages are more common than you think, if not in nature, then certainly in language. Across different cultures, mirages frequently appear in idioms serving as metaphors for <b>illusion</b>, <b>false hope</b> or <b>unattainable goals</b>.</p><img class="content-pic" src="images/flower_card2_content.jpg" alt="Mirage Illusion" style="margin: 20px 0;"><div style="background-color: rgba(255,255,255,0.7); padding: 15px; border-left: 4px solid #555; margin: 20px 0;"><p style="margin-bottom: 10px;"><b>üá®üá≥ Chinese:</b><br><b>Êµ∑Â∏ÇËúÉÊ•º (H«éi sh√¨ sh√®n l√≥u)</b>: Meaning "city of the sea, towers of the mirage-monster". In mythology, <i>sh√®n</i> is a sea monster that exhales vapour to form illusory cities.</p><p style="margin-bottom: 10px;"><b>üá¨üáß English / üá™üá∏ Spanish / üá´üá∑ French:</b><br>Expressions like "chasing a mirage" or <i>correr tras espejismos</i> suggest pursuing something unreal or unachievable.</p><p style="margin: 0;"><b>üáÆüá≥ Hindi:</b><br><b>‡§Æ‡•É‡§ó‡§§‡•É‡§∑‡•ç‡§£‡§æ (Mrigtrishna)</b>: Literally "deer‚Äôs thirst", referring to a desert mirage that deceives deer into seeking water‚Äîsymbolizing the relentless pursuit of an illusion.</p></div><p>Across cultures, the mirage endures as a powerful image of elusive beauty. In language, as in life, mirages mark the fine line between promise and illusion.</p>`, longHtml: `` },
                        { shortHtml: `<h2 style="font-weight: 900; text-transform: uppercase; font-size: 1.8rem; line-height: 1.2; margin-bottom: 20px; color: #1a5f1a;">MIRAGES ‚Äì<br>WANT TO WITNESS AN ILLUSION?</h2><p style="font-size: 1.1rem; font-weight: bold; margin-bottom: 15px;">Want to witness a natural illusion with your own eyes?</p><div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 12px; border: 1px solid #ddd;"><p style="margin-bottom: 15px;">üí° <b>Tip:</b> Always keep your eyes open, mirages can appear and disappear in a matter of minutes!</p><p style="margin-bottom: 15px;"><b>‚è≥ Timing:</b><br>Dawn or dusk is the best time as temperatures are rapidly changing.</p><p style="margin-bottom: 15px;"><b>üìç Location:</b><br>Mountainous areas (drastic difference of altitude), deserts (or big surfaces of hot areas), and naturally big surfaces of water.</p></div>`, longHtml: `` }
                    ]
                }
            ]
        },
        water: {
            bg: 'images/blue1.png',
            dims: { w: '323.43px', h: '260.62px' }, 
            frames: 7, pathPrefix: 'svgs/Swim_man_', ext: '.svg',
            objects: [
                { 
                    id: 'jellyfish', src: 'images/jellyfish.png', w: '150px', h: '150px', left: '40%', bottom: '50%',
                    content: [
                        { shortHtml: `<div style="margin-bottom: 20px;"><p style="font-size: 0.9rem; border-left: 4px solid #000; padding-left: 10px; line-height: 1.4;"><span style="font-weight: 900; text-transform: uppercase;">Fun Fact: Did you know?</span><br>Cyanobacteria are responsible for producing much of the oxygen in Earth‚Äôs atmosphere, including the oxygen you are breathing right now?!</p><h2 style="font-weight: 900; text-transform: uppercase; font-size: 2rem; line-height: 1.1; margin-top: 15px; border-bottom: none;">EARTH‚ÄôS GREEN PIONEERS ‚Äì<br>CYANOBACTERIA</h2></div><img class="content-pic" src="images/jellyfish_content_1.jpg" alt="Cyanobacteria" style="margin-bottom: 5px;"><p style="font-size: 0.8rem; font-style: italic; color: #555; margin-bottom: 20px;">Cyanobacteria - the powerful Atmospheric Architects</p><p>Some organisms thrive in the conditions created by <b>eutrophication</b>, among them are <b>cyanobacteria</b>. Often mistaken for algae, cyanobacteria are actually <b>aquatic microbes</b> that helped shape life on Earth. Billions of years ago, when the planet was rich in carbon dioxide and merely free of oxygen, they changed everything.</p><p>Cyanobacteria were the first organisms to use sunlight, water, and carbon dioxide to make sugar, a process we now call <b>photosynthesis</b>. In doing so, they released oxygen into the atmosphere, which was toxic to most life at the time. Even many cyanobacteria couldn‚Äôt survive the change. But those that did adapted, learning not only to tolerate oxygen, but to use it. For billions of years, they dominated Earth‚Äôs oceans and quietly set the stage for <b>complex life</b>, including us.</p><p>Today, human activity is tipping the balance back into their favour. Warmer waters, rising CO2 levels, and nutrient-rich runoff from agriculture create ideal conditions for cyanobacteria to bloom. These heat-tolerant microbes absorb light and nutrients rapidly and can produce <b>toxins</b> that harm animals, ecosystems, and people. When large blooms die of their decomposition can drain oxygen from the water, creating massive <b>dead zones</b> where fish, insects and plants cannot survive.</p><p style="font-weight: bold; margin-top: 30px; margin-bottom: 60px;">Want to know more? (And gain more points! 5 times more!)</p>`, longHtml: `<div style="margin-bottom: 20px;"><p style="font-size: 0.9rem; border-left: 4px solid #000; padding-left: 10px; line-height: 1.4;"><span style="font-weight: 900; text-transform: uppercase;">Fun Fact: Did you know?</span><br>Cyanobacteria can be scientifically categorised as the evolutionary ancestors of algae?!</p><h2 style="font-weight: 900; text-transform: uppercase; font-size: 2rem; line-height: 1.1; margin-top: 15px; border-bottom: none;">THE ANCESTORS OF ALGAE ‚Äì<br>CYANOBACTERIA</h2></div><img class="content-pic" src="images/jellyfish_content_2.jpg" alt="Cyanobacteria" style="margin-bottom: 5px;"><p style="font-size: 0.8rem; font-style: italic; color: #555; margin-bottom: 20px;">Cyanobacteria, often historically referred to as "blue-green algae"</p><p><b>Cyanobacteria</b> are a phylum of bacteria that obtain their energy through oxygenic photosynthesis. Despite their colloquial name, they are not true algae but are <b>prokaryotic organisms</b>‚Äîsingle-celled organisms lacking a nucleus and membrane-bound organelles. As some of the oldest organisms on Earth, they have existed for at least 2.1 to 3.5 billion years and are recognised as the primary agents behind the Great Oxidation Event, which oxygenated the atmosphere.</p><h3 style="color: #1a5f1a; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 20px;">Characteristics and Morphology</h3><p>Cyanobacteria possess <b>chlorophyll-a</b>, which provides their characteristic green colour, alongside pigments such as phycocyanin (blue) and phycoerythrin (red), enabling them <b>to absorb various wavelengths of light</b>. They exist in diverse forms, ranging from unicellular to filamentous colonies. Many species possess gas vesicles, allowing them to regulate buoyancy and move vertically in the water column to maximise sunlight exposure and access nutrients. Additionally, some species can fix nitrogen from the atmosphere into usable chemical forms (like ammonia) using specialised cells called <b>heterocyst</b>.</p><h3 style="color: #1a5f1a; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 20px;">Habitat and Ecological Importance</h3><p>These microorganisms are ubiquitously found in <b>aquatic environments</b>, including freshwater, marine, and coastal waters, as well as in soil and on rock surfaces. They are fundamental components of marine food webs and major contributors to global <b>carbon and nitrogen cycles</b>. Furthermore, they have <b>symbiotic relationships</b> with various organisms, such as <b>lichens and ferns</b>, and can survive in extreme habitats, from hot springs to frozen environments.</p><h3 style="color: #1a5f1a; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 20px;">Role in Ecosystems and Human Health</h3><p>While generally beneficial as primary producers, cyanobacteria are also infamous for forming dense "blooms" in nutrient-rich (eutrophic), warm, and stagnant waters. These, often referred to as Harmful Algal Blooms (HABs), occur due to excess nutrients like phosphorus and nitrogen. Such blooms can cause significant environmental and economic issues by producing potent toxins, known as <b>cyano-toxins</b>, which can <b>damage liver and brain function</b> in humans, livestock, and wildlife.</p><h3 style="color: #1a5f1a; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 20px;">Applications and Biotechnology</h3><p>Beyond their environmental impacts, cyanobacteria are valuable resources in <b>biotechnology</b> and <b>sustainable agriculture</b>. They are used as biofertilizers in rice paddies and for bioremediation, such as <b>treating wastewater</b>. Certain species, like <b>Spirulina</b>, are consumed as food, while others are studied for producing bioenergy, valuable metabolites, and in ecological restoration of degraded lands.</p><h3 style="color: #1a5f1a; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 20px;">Evolutionary Significance</h3><p>Cyanobacteria are widely believed to be the <b>ancestors of the chloroplast</b> in eukaryotic cells, which evolved through a process called endosymbiosis. Their ability to photosynthesise and create oxygen changed the Earth's early reducing atmosphere into an oxidising one, leading to <b>the development of complex life</b>.</p><p style="font-weight: bold; margin-top: 30px; margin-bottom: 60px;">Want to know what actions you can take to prevent Algal bloom? Take a look at our Action zone and gain more points!</p>` },
                        { shortHtml: `<h2 style="font-weight: 900; text-transform: uppercase; font-size: 1.8rem; line-height: 1.2; margin-bottom: 20px; color: #1a5f1a;">CYANOBACTERIA ‚Äì<br>OLDEST FORMS OF LIFE ON EARTH</h2><p>The oldest fossilized evidence of life on Earth are <b>stromatolites</b>. They are layered sedimentary rock formations created over 3.5 billion years ago by photosynthetic cyanobacteria. By trapping sediment and precipitating calcium carbonate, these organisms built distinct rocky mounds that thrived, dominated and oxygenated the atmosphere, ultimately triggering the Great Oxidation Event.</p><img class="content-pic" src="images/jellyfish_card2_content.jpg" alt="Stromatolites" style="margin: 20px 0;"><p>Stromatolites are made up of successive layers of microbes growing over older, trapped sediments. This distinctive layered structure is what earned them the name of "rock mattresses".</p><p>Often referred to as "living fossils", stromatolites still exist today, though they are rare. Modern examples can be found along the coast of Australia, in Yellowstone National Park and in certain saline lakes around the world.</p><div style="background-color: rgba(255,255,255,0.7); padding: 15px; border-left: 4px solid #555; margin: 20px 0;"><p style="margin: 0;"><b>üí° Fun fact!</b> Stromatolites are representatives of life before dinosaurs!</p></div>`, longHtml: `` },
                        { shortHtml: `<h2 style="font-weight: 900; text-transform: uppercase; font-size: 1.8rem; line-height: 1.2; margin-bottom: 20px; color: #1a5f1a;">MARINE DEAD ZONE ‚Äì<br>ACTIONS</h2><div style="margin-bottom: 20px;"><p style="margin-bottom: 15px;"><b>1. Support organic and regenerative agriculture:</b><br>Look for labels like <b>USDA Organic</b>, <b>EU Organic Leaf</b>, <b>Regenerative Organic Certified (ROC)</b>. These standards avoid synthetic inputs (pesticides, fertilisers) and prioritise soil health restoration.</p><p style="margin-bottom: 15px;"><b>2. Reduce phosphorus in detergents:</b><br>Many detergents are now phosphate-free to protect waterways. Look for brands like Tide, Gain, Seventh Generation, or certifications like "EWG Verified".</p><p style="margin-bottom: 15px;"><b>3. Cut back on meat consumption:</b><br>Choose eco-friendly options like Mussels/Oysters, chicken, or wild game. Look for <b>Regenerative agriculture</b>, <b>Pasture-raised</b>, or <b>Grass-fed</b> labels.</p><p style="margin-bottom: 15px;"><b>4. Choose eco-certified seafood:</b><br>Look for <b>MSC</b> (wild-caught) or <b>ASC</b> (farmed) certifications to ensure healthy fish populations and minimal ecosystem impact.</p><img class="content-pic" src="images/jellyfish_card3_content.jpg" alt="Action Labels" style="margin: 20px 0; background: white; padding: 10px; border-radius: 8px;"><div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 12px; border: 1px solid #ddd; margin-top: 20px;"><h3 style="margin-top: 0; color: #1a5f1a; font-size: 1.2rem;">Exploring Ocean Dead Zones</h3><p style="margin-bottom: 5px;"><b>Where?</b> Coastal waters and river mouths (e.g., Gulf of Mexico).</p><p style="margin-bottom: 5px;"><b>When?</b> Most severe in summer (warm water blocks oxygen mixing).</p><p style="margin-bottom: 0;"><b>What to look for?</b> Disappearing fish and mass die-offs. Below the surface, they are oxygen-depleted and barren.</p></div></div>`, longHtml: `` }
                    ]
                },
                { 
                    id: 'fish', src: 'images/fish.png', w: '200px', h: '200px', left: '70%', bottom: '70%',
                    content: [
                        { shortHtml: `<div style="margin-bottom: 20px;"><p style="font-size: 0.9rem; border-left: 4px solid #000; padding-left: 10px; line-height: 1.4;"><span style="font-weight: 900; text-transform: uppercase;">Fun Fact: Did you know?</span><br>Even our Earth's giant, the ocean, could stand still without any lifeforms?!</p><h2 style="font-weight: 900; text-transform: uppercase; font-size: 2rem; line-height: 1.1; margin-top: 15px; border-bottom: none;">THE SILENCE ‚Äì<br>MARINE DEAD ZONES</h2></div><img class="content-pic" src="images/fish_content_1.jpg" alt="The Sea in Silence" style="margin-bottom: 5px;"><p style="font-size: 0.8rem; font-style: italic; color: #555; margin-bottom: 20px;">The sea in silence...</p><p>Water sustains all life on Earth. Oceans account for 97% of all water resources, regulating our climates and serving as the right lung of our Earth. However, marine dead zones are increasing, turning vibrant ecosystems into silent graveyards.</p><p style="font-weight: bold; margin-top: 30px; margin-bottom: 60px;">Want to dive deeper into the silence?</p>`, longHtml: `<div style="margin-bottom: 20px;"><p style="font-size: 0.9rem; border-left: 4px solid #000; padding-left: 10px; line-height: 1.4;"><span style="font-weight: 900; text-transform: uppercase;">Fun Fact: Did you know?</span><br>Even the ocean can become stinky (no, not salty!) due to decomposition?!</p><h2 style="font-weight: 900; text-transform: uppercase; font-size: 2rem; line-height: 1.1; margin-top: 15px; border-bottom: none;">THE OCEANS THAT WENT QUIET ‚Äì<br>MARINE DEAD ZONES</h2></div><img class="content-pic" src="images/fish_content_2.jpg" alt="Algal Blooms" style="margin-bottom: 5px;"><p style="font-size: 0.8rem; font-style: italic; color: #555; margin-bottom: 20px;">Creepy Dead Zones and Algal Blooms</p><h3 style="color: #1a5f1a; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 20px;">Causes and Formation</h3><p>The primary driver of dead zones is <b>eutrophication</b>, a process driven by nutrient pollution‚Äîspecifically nitrogen and phosphorus.</p><ul style="padding-left: 20px; line-height: 1.6;"><li><b>Agricultural Runoff:</b> Fertiliser runoff from farms flows into rivers and eventually the sea, fuelling massive algae growth.</li><li><b>Sewage and Industry:</b> Untreated sewage and industrial waste contribute to nutrient overload.</li><li><b>Algal Blooms:</b> Nutrients trigger immense blooms. Their decomposition consumes vast amounts of dissolved oxygen.</li><li><b>Stratification:</b> In warmer months, water layers prevent oxygen-rich surface water from mixing with the bottom.</li></ul><h3 style="color: #1a5f1a; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 20px;">Impact on Marine Ecosystems & Humans</h3><p>Dead zones create <b>suffocating conditions</b>, leading to a dramatic loss in biodiversity. While bacteria may thrive, habitats for commercial species are destroyed. This causes billions in economic losses for fishing industries and tourism, threatening global food security.</p><h3 style="color: #1a5f1a; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 20px;">Sound of Silence & Hope</h3><p>Sound ecologists noted that dead zones are <b>acoustically depleted</b>: the steady noise of marine life simply disappears. However, dead zones are not always permanent. When nutrient pollution is reduced, oxygen can return, offering a rare note of hope.</p><p style="font-weight: bold; margin-top: 30px; margin-bottom: 60px;">Want to know what actions matter to save our giant engine?</p>` },
                        { shortHtml: `<h2 style="font-weight: 900; text-transform: uppercase; font-size: 1.8rem; line-height: 1.2; margin-bottom: 20px; color: #1a5f1a;">MARINE DEAD ZONES ‚Äì<br>COASTAL HERITAGES AT RISK</h2><p>Many coastal and marine UNESCO World Heritage Sites, such as those in the Baltic Sea or the Gulf of Mexico, are recognized not just for their beauty and rich biodiversity, but also for the human cultures that have thrived alongside them for centuries.</p><img class="content-pic" src="images/fish_card2_content.jpg" alt="Coastal Heritage" style="margin: 20px 0;"><p>Today, nutrient pollution and shifting ocean conditions threaten both marine life and human traditions. While not all are dead zones yet, many lie dangerously close, putting centuries of heritage at risk:</p><ul style="padding-left: 20px; line-height: 1.6;"><li><b>Kvarken Archipelago:</b> Between Finland and Sweden.</li><li><b>Everglades National Park:</b> Southern Florida, where freshwater meets salt.</li><li><b>Gulf of California:</b> Islands and protected areas, now listed as World Heritage in Danger.</li><li><b>Banc d‚ÄôArguin National Park:</b> Mauritania, a crucial refuge for birds.</li></ul><p>Across the globe, these coastal treasures remind us that culture and nature are inseparable. If we hope to preserve these beautiful sites, it falls to us to protect them.</p>`, longHtml: `` },
                        { shortHtml: `<h2 style="font-weight: 900; text-transform: uppercase; font-size: 1.8rem; line-height: 1.2; margin-bottom: 20px; color: #1a5f1a;">MARINE DEAD ZONE ‚Äì<br>ACTIONS</h2><div style="margin-bottom: 20px;"><p style="margin-bottom: 15px;"><b>1. Support organic and regenerative agriculture:</b><br>Look for labels like <b>USDA Organic</b>, <b>EU Organic Leaf</b>, <b>Regenerative Organic Certified (ROC)</b>. These standards avoid synthetic inputs and prioritise soil health restoration.</p><p style="margin-bottom: 15px;"><b>2. Reduce phosphorus in detergents:</b><br>Many detergents are now phosphate-free to protect waterways. Look for brands like Tide, Gain, Seventh Generation, or certifications like "EWG Verified".</p><p style="margin-bottom: 15px;"><b>3. Cut back on meat consumption:</b><br>Choose eco-friendly options like Mussels/Oysters. Look for <b>Pasture-raised</b> or <b>Grass-fed</b> labels to reduce agricultural runoff associated with industrial livestock.</p><p style="margin-bottom: 15px;"><b>4. Choose eco-certified seafood:</b><br>Look for <b>MSC</b> (wild-caught) or <b>ASC</b> (farmed) certifications to ensure healthy fish populations and minimal ecosystem impact.</p><img class="content-pic" src="images/fish_card3_content.jpg" alt="Eco Certifications" style="margin: 20px 0; background: white; padding: 10px; border-radius: 8px;"><div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 12px; border: 1px solid #ddd; margin-top: 20px;"><h3 style="margin-top: 0; color: #1a5f1a; font-size: 1.2rem;">Exploring Ocean Dead Zones</h3><p style="margin-bottom: 5px;"><b>Where?</b> Coastal waters and river mouths (e.g., Gulf of Mexico).</p><p style="margin-bottom: 5px;"><b>When?</b> Most severe in summer (warm water blocks oxygen mixing).</p><p style="margin-bottom: 0;"><b>What to look for?</b> Disappearing fish and mass die-offs. Below the surface, they are oxygen-depleted and barren.</p></div></div>`, longHtml: `` }
                    ]
                }
            ]
        }
    };

    /* =========================================
       STATE & ELEMENTS
       ========================================= */
    const state = { isWater: false, isLocked: true, charX: 50, frameIndex: 1, direction: 1, currentActiveObj: null, currentCardIndex: 0 };

    const el = {
        loadingScreen: document.getElementById('loading-screen'),
        loadingBar: document.querySelector('.loading-bar'),
        loadingText: document.querySelector('.loading-text'),
        gameStage: document.getElementById('game-stage'),
        char: document.getElementById('character'),
        scrollingLayer: document.getElementById('scrolling-layer'),
        bgImg: document.getElementById('bg-img'),
        wave: document.getElementById('transition-wave'),
        obj1: document.getElementById('obj1'),
        obj2: document.getElementById('obj2'),
        
        cardSystem: document.getElementById('card-system'),
        cardLeft: document.getElementById('card-left-display'),
        stackWrappers: document.querySelectorAll('.card-stack-wrapper'),
        stackImages: [
            document.getElementById('stack-img-1'),
            document.getElementById('stack-img-2'),
            document.getElementById('stack-img-3')
        ],
        readMoreBtns: document.querySelectorAll('.read-more-btn'),
        closeCardBtns: document.querySelectorAll('.card-close-btn'), // üî¥ New selection
        
        modal: document.getElementById('universal-modal'),
        modalImg: document.getElementById('modal-bg-img'),
        modalContent: document.getElementById('modal-content-area'),
        
        btnMusic: document.getElementById('modal-btn-music'),
        btnNextLayer: document.getElementById('modal-btn-next-layer'),
        btnGainPoints: document.getElementById('modal-btn-gain-points'),
        btnClose: document.getElementById('modal-btn-close'),

        bgMusic: new Audio('wavs/Green Cloud Forest - Project - Curiosity of Nature 1.wav')
    };

    /* =========================================
       LOGIC: PRELOAD & INIT
       ========================================= */
    function preloadAllAssets() {
        if (!CONFIG.land || !CONFIG.water) { console.error("CONFIG object malformed!"); return; }
        let imagesToLoad = [
            'images/wave.png', CONFIG.land.bg, CONFIG.water.bg, 
            'images/READ_MORE.png', 'images/text_short.png', 'images/text_long.png', 
            'images/PLAY_MUSIC.png', 'images/GAIN_POINTS.png', 'images/cross.png', 'images/card2.png', 'images/card3.png',
            'images/fern_content_1.jpg', 'images/fern_content_2.jpg', 'images/fern_card2_content.jpg', 'images/fern_card3_certs.jpg',
            'images/flower_content_1.jpg', 'images/flower_content_2.jpg', 'images/flower_card2_content.jpg', 'images/flower_card3_content.jpg',
            'images/jellyfish_content_1.jpg', 'images/jellyfish_content_2.jpg', 'images/jellyfish_card2_content.jpg', 'images/jellyfish_card3_content.jpg',
            'images/fish_content_1.jpg', 'images/fish_content_2.jpg', 'images/fish_card2_content.jpg', 'images/fish_card3_content.jpg'
        ];
        
        const landObjs = CONFIG.land.objects || [];
        const waterObjs = CONFIG.water.objects || [];
        const allObjects = [...landObjs, ...waterObjs];

        allObjects.forEach(obj => {
            if (obj && obj.src) {
                imagesToLoad.push(obj.src);
                imagesToLoad.push(obj.src.replace('.png', '-glow.png'));
                imagesToLoad.push(`images/${obj.id}_card_left.png`);
                imagesToLoad.push(`images/${obj.id}_card_1.png`);
                imagesToLoad.push(`images/${obj.id}_card_2.png`);
                imagesToLoad.push(`images/${obj.id}_card_3.png`);
            }
        });

        for(let i=1; i<=CONFIG.land.frames; i++) imagesToLoad.push(`${CONFIG.land.pathPrefix}${i}${CONFIG.land.ext}`);
        for(let i=1; i<=CONFIG.water.frames; i++) imagesToLoad.push(`${CONFIG.water.pathPrefix}${i}${CONFIG.water.ext}`);

        let loadedCount = 0; const total = imagesToLoad.length;
        if (total === 0) { startGame(); return; }
        imagesToLoad.forEach(src => {
            const img = new Image(); img.src = src;
            img.onload = () => { loadedCount++; updateLoadingProgress(loadedCount, total); };
            img.onerror = () => { console.warn(`Failed to load: ${src}`); loadedCount++; updateLoadingProgress(loadedCount, total); };
        });
    }
    function updateLoadingProgress(current, total) {
        const percent = Math.floor((current / total) * 100);
        el.loadingBar.style.width = `${percent}%`; el.loadingText.textContent = `LOADING... ${percent}%`;
        if (current >= total) { setTimeout(startGame, 500); }
    }
    function startGame() {
        el.loadingScreen.classList.add('fade-out'); el.gameStage.classList.add('ready');
        el.bgImg.onload = () => { render(); };
        el.bgMusic.loop = true;
        updateSceneAssets(); setupObjectInteractions(); setupCardSystem(); setupModalLogic(); 
        render(); setTimeout(() => { state.isLocked = false; }, 500);
    }

    function getObjectDataById(id) {
        const landObjs = CONFIG.land.objects || [];
        const waterObjs = CONFIG.water.objects || [];
        const all = [...landObjs, ...waterObjs];
        return all.find(obj => obj.id === id);
    }

    function setupObjectInteractions() {
        const objects = [el.obj1, el.obj2];
        objects.forEach(obj => {
            obj.addEventListener('mouseenter', () => {
                let currentBg = obj.style.backgroundImage;
                if (currentBg && currentBg.indexOf('-glow') === -1) obj.style.backgroundImage = currentBg.replace('.png', '-glow.png');
            });
            obj.addEventListener('mouseleave', () => {
                let currentBg = obj.style.backgroundImage;
                if (currentBg && currentBg.indexOf('-glow') !== -1) obj.style.backgroundImage = currentBg.replace('-glow.png', '.png');
            });
            obj.addEventListener('click', (e) => {
                e.stopPropagation();
                const conf = state.isWater ? CONFIG.water : CONFIG.land;
                const objData = (obj === el.obj1) ? conf.objects[0] : conf.objects[1];
                openCards(objData.id);
            });
        });
    }

    /* =========================================
       LOGIC: MODAL HANDLING
       ========================================= */
    function setupModalLogic() {
        const closeAction = () => {
            el.modal.classList.remove('show');
            setTimeout(() => { el.modal.classList.remove('zoomed'); el.modalContent.scrollTop = 0; }, 300);
            stopMusic();
        };
        el.modal.addEventListener('click', closeAction);
        el.btnClose.addEventListener('click', (e) => { e.stopPropagation(); closeAction(); });

        el.modalImg.addEventListener('click', (e) => { e.stopPropagation(); el.modal.classList.toggle('zoomed'); });

        el.btnMusic.addEventListener('click', (e) => {
            e.stopPropagation();
            if (el.bgMusic.paused) { 
                el.bgMusic.play().catch(e=>console.log(e)); 
                el.btnMusic.classList.add('playing'); 
            } else { 
                el.bgMusic.pause(); el.bgMusic.currentTime = 0; 
                el.btnMusic.classList.remove('playing'); 
            }
        });

        el.btnNextLayer.addEventListener('click', (e) => {
            e.stopPropagation();
            if(state.currentActiveObj && state.currentActiveObj.content) {
                const cardData = state.currentActiveObj.content[state.currentCardIndex];
                if(cardData.longHtml) {
                    el.modalContent.innerHTML = cardData.longHtml;
                    el.modalImg.src = 'images/text_long.png'; // Switch to Long BG
                    
                    el.btnNextLayer.classList.add('hidden');
                    el.btnGainPoints.classList.remove('hidden');
                    
                    el.modalContent.scrollTop = 0;
                }
            }
        });

        el.btnGainPoints.addEventListener('click', (e) => { e.stopPropagation(); console.log("Points Gained"); });
    }

    function openModal(cardIndex) {
        state.currentCardIndex = cardIndex;
        if (!state.currentActiveObj || !state.currentActiveObj.content) return;
        const cardData = state.currentActiveObj.content[cardIndex];

        // 1. Reset Content
        el.modalContent.innerHTML = cardData.shortHtml;
        el.modalContent.scrollTop = 0;

        // 2. Set Background
        if (cardIndex === 0) el.modalImg.src = 'images/text_short.png';
        else if (cardIndex === 1) el.modalImg.src = 'images/card2.png';
        else if (cardIndex === 2) el.modalImg.src = 'images/card3.png';

        // 3. Configure Buttons
        if (cardIndex === 0) {
            el.btnMusic.classList.remove('hidden');
            el.btnNextLayer.classList.remove('hidden');
            el.btnGainPoints.classList.add('hidden');
        } else {
            el.btnMusic.classList.add('hidden');
            el.btnNextLayer.classList.add('hidden');
            el.btnGainPoints.classList.remove('hidden');
        }

        el.modal.classList.add('show');
    }

    function stopMusic() { 
        el.bgMusic.pause(); el.bgMusic.currentTime = 0; 
        el.btnMusic.classList.remove('playing'); 
    }

    /* =========================================
       LOGIC: CARD SYSTEM
       ========================================= */
    function setupCardSystem() {
        el.stackWrappers.forEach(wrapper => {
            wrapper.addEventListener('click', (e) => {
                e.stopPropagation();
                if (wrapper.getAttribute('data-layer') !== "1") rotateStack(wrapper);
            });
        });
        el.cardLeft.addEventListener('click', (e) => { e.stopPropagation(); });
        el.cardSystem.addEventListener('click', () => { /* Background click closes cards */ closeCards(); });

        el.readMoreBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const index = parseInt(e.target.getAttribute('data-card-index'));
                openModal(index);
            });
        });

        // üî¥ Bind Close Buttons on Cards
        el.closeCardBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                closeCards();
            });
        });
    }

    function openCards(objectId) {
        state.isLocked = true;
        state.currentActiveObj = getObjectDataById(objectId);

        el.cardLeft.src = `images/${objectId}_card_left.png`;
        el.stackImages.forEach((img, index) => { img.src = `images/${objectId}_card_${index + 1}.png`; });
        el.stackWrappers.forEach((wrapper, index) => { wrapper.setAttribute('data-layer', index + 1); });

        el.cardSystem.classList.add('show');
    }

    function closeCards() { state.isLocked = false; el.cardSystem.classList.remove('show'); }

    function rotateStack(clickedWrapper) {
        const layer1 = document.querySelector('.card-stack-wrapper[data-layer="1"]');
        const layer2 = document.querySelector('.card-stack-wrapper[data-layer="2"]');
        const layer3 = document.querySelector('.card-stack-wrapper[data-layer="3"]');
        const currentLayer = clickedWrapper.getAttribute('data-layer');
        if (currentLayer === "2") { clickedWrapper.setAttribute('data-layer', 1); layer1.setAttribute('data-layer', 3); layer3.setAttribute('data-layer', 2); }
        else if (currentLayer === "3") { clickedWrapper.setAttribute('data-layer', 1); layer1.setAttribute('data-layer', 2); layer2.setAttribute('data-layer', 3); }
    }

    /* =========================================
       LOGIC: SCROLL & RENDER
       ========================================= */
    window.addEventListener('wheel', (e) => {
        if (state.isLocked) return; e.preventDefault();
        const moveDirection = e.deltaY > 0 ? 1 : -1; const speed = 8; state.direction = moveDirection;
        let nextCharX = state.charX + (moveDirection === 1 ? speed : -speed);
        if (!state.isWater) { if (nextCharX < 0) nextCharX = 0; } else { const maxRight = window.innerWidth - el.char.offsetWidth; if (nextCharX > maxRight) nextCharX = maxRight; }
        if (nextCharX !== state.charX) { state.charX = nextCharX; state.frameIndex += 0.25; }
        if (moveDirection === 1) { if (!state.isWater && state.charX > window.innerWidth) triggerTransition('toWater'); } else { if (state.isWater && state.charX < -50) triggerTransition('toLand'); }
        render();
    }, { passive: false });

    function getSyncedBgX() {
        const stageWidth = window.innerWidth; const bgWidth = el.bgImg.offsetWidth || stageWidth; 
        if (bgWidth <= stageWidth) return 0; const maxBgScroll = bgWidth - stageWidth;
        let progress = state.charX / stageWidth; progress = Math.min(Math.max(progress, 0), 1);
        return - (progress * maxBgScroll);
    }
    function render() {
        const scale = state.direction === 1 ? 'scaleX(1)' : 'scaleX(-1)'; el.char.style.transform = `translateX(${state.charX}px) ${scale}`;
        const bgX = getSyncedBgX(); el.scrollingLayer.style.transform = `translateX(${bgX}px)`;
        const currentConf = state.isWater ? CONFIG.water : CONFIG.land; const frameNum = Math.floor(state.frameIndex) % currentConf.frames + 1;
        el.char.style.backgroundImage = `url('${currentConf.pathPrefix}${frameNum}${currentConf.ext}')`;
    }
    function updateSceneAssets() {
        const conf = state.isWater ? CONFIG.water : CONFIG.land; el.char.style.width = conf.dims.w; el.char.style.height = conf.dims.h; state.frameIndex = 1; el.bgImg.src = conf.bg;
        const o1 = conf.objects[0]; const o2 = conf.objects[1];
        el.obj1.style.backgroundImage = `url('${o1.src}')`; el.obj1.style.width = o1.w; el.obj1.style.height = o1.h; el.obj1.style.left = o1.left; el.obj1.style.bottom = o1.bottom;
        el.obj2.style.backgroundImage = `url('${o2.src}')`; el.obj2.style.width = o2.w; el.obj2.style.height = o2.h; el.obj2.style.left = o2.left; el.obj2.style.bottom = o2.bottom;
    }
    function triggerTransition(type) {
        if (state.isLocked) return; state.isLocked = true; el.wave.classList.add('active');
        setTimeout(() => { if (type === 'toWater') { state.isWater = true; state.charX = 0; } else { state.isWater = false; state.charX = window.innerWidth; } updateSceneAssets(); el.bgImg.onload = () => { render(); }; render(); }, 1200);
        setTimeout(() => { el.wave.classList.remove('active'); state.isLocked = false; }, 2500);
    }
    window.addEventListener('resize', () => { render(); });
    preloadAllAssets();
</script>
</body>
</html>
